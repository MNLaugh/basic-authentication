"use strict";function end_empty(){}function end_err(a,b){return void 0!==a?a(new Error(b)):new Error(b)}function end_work(a,b,c,d){if(void 0===c)return void 0!==b?b():!0;var e=http[c];return void 0!==d&&(d.writeHead(c),d.end(e)),a(b,e)}function end_check(a,b){return a!==b}function end_check_file(a,b,c){var d,e=crypto(b),f=require("fs").readFileSync(c,{encoding:"utf8"}).match(/(.+)/g);d=f.length?f.length:0;var g=basic_legacy(a,!0),h=e.update(g.password).digest("hex");g=new RegExp("^"+g.user+":");for(var i=0;d>i;i++)if(g.test(f[i])){var j=f[i].substring(g.source.length-1);if(j===h)return!1}return!0}function basic_legacy(a,b){var c;return b===!0?(c=new Buffer(a,"base64").toString(),c=c.match(/^([^:]*):(.*)$/),{user:c[1],password:c[2]}):void 0!==a.headers&&void 0!==(c=a.headers.authorization)&&(c=c.match(reg))&&void 0!==c[1]&&(c=new Buffer(c[1],"base64").toString().match(/^([^:]*):(.*)$/),void 0!==c)?{user:c[1],password:c[2]}:Object.create(null)}function basic_small(a){var b;return void 0!==a.headers&&void 0!==(b=a.headers.authorization)&&reg.test(b)===!0?b.substring(6):""}function authentication(a){function b(){var a=end_check;e.file&&(a=end_check_file);var b=end_err;return e.suppress&&(b=end_empty),function(c,d,f){var g=basic_small(c);return""!==g?a(g,e.hash,e.file)===!0?(setHeader(d,"WWW-Authenticate",e.realms,!0),end_work(b,f,401)):""===e.agent||e.agent===c.headers["user-agent"]?end_work(b,f):end_work(b,f,403):(d.writeHead(401,e.realm),d.end())}}function c(){var a=end_check;e.file&&(a=end_check_file);var b=end_err;return e.suppress&&(b=end_empty),function(c,d,f){var g=basic_small(c);return""!==g?a(g,e.hash,e.file)===!0?(setHeader(d,"WWW-Authenticate",e.realms,!0),end_work(b,f,401,d)):""===e.agent||e.agent===c.headers["user-agent"]?end_work(b,f):end_work(b,f,403,d):(d.writeHead(401,e.realm),d.end(http[401]))}}var d=a||Object.create(null),e={file:Boolean(d.file),agent:String(d.agent||""),realm:String(d.realm||"Authorization required"),suppress:Boolean(d.suppress)};if(e.realms='Basic realm="'+e.realm+'"',e.realm={"WWW-Authenticate":e.realms},e.file){if(e.hash=String(d.hash||"md5"),e.file=require("path").resolve(String(d.file)),!require("fs").existsSync(e.file)){var f=e.file+" not exists";throw new Error(f)}}else{var g=String(d.user||"admin"),h=String(d.password||"password");e.hash=new Buffer(g+":"+h).toString("base64")}return Boolean(d.legacy)?basic_legacy:Boolean(d.functions)?basic_small:(d.ending===!1?0:1)?c():b()}try{var reg=new RegExp(/^Basic (.*)$/),http=require("http").STATUS_CODES,crypto=require("crypto").createHash,setHeader=require("setheaders")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=authentication;
